sudo: required
language: generic
cache:
  directories:
  - vendor/bundle
  - node_modules
  - "$HOME/.nvm"
rvm:
- 2.5.3
addons:
  postgresql: '9.6'
  chrome: stable
env:
  global:
  - RAILS_ENV=test
  - TRAVIS_ENDPOINT="https://api.travis-ci.com"
  - TRAVIS_QUEUE_BRANCHES=master
  - secure: hkXAVh2OMrFY4uVP9JQwBgyiFdUacu9BASMIel8k29bMMNXohwNQvqnGbAiMpVD/CPpmzm+pxwhrRXOu27uS24SJTKjJZpLcVH5uu+WQRqIzXdMM4v1d30sFgil4H34HVt4tGXsNct5rVl2R9v2xxgYW9C3Lq8NMRDgmN5G3ghgrf1ENEyfhDtGM9b0Rz2uTmxGNWT3I+EVydUMV5M4gG5yDXFmEhDeW+kx6c/HS3psoZ8bpMWlbV+rkUuMd2bsDAKPgH28QHl3Fec6asYVkksvV/+H0m3AnMFbR4jO/hGS0oW+6PGyBvHQ2B/KRCQkjDJ4+kgsGg0kFUqkNiKUKDmieRUIDerHX57aSfN25jsmZm2eyY+pSc6KgCzoLLiRaHN8j3Om6lT5tbSEzgfXjTJzMDWH4bxJ1fvOz3Lcl3OAdx7OiuGnlfobojrQ6P49Pm6qTJkICDVAU1x28t7S1tX4w/jA4be5V5mWS5XYJkiJnOorgGgyn1/INgjLuJwOQrqlfT4OYGVY7z8061anEUDaV/UWVr1Vfc7/tVnKzXo39RnkQY9B8ANWuElxMBRE8LJrJNtKzFeQGH3SBsGCxYFmAY0x/Iw7Gy9mSzE1WvMSw5J697waB7e7N1CoN7RQo3MP1P+2hGPBqvNRSMRPlyDhNBSHGtk+uqBSH6vQweYk=
  - secure: TE5XePiG76/C9JzFl03Nf+G3x9alVVH8UueymlsF3X4MmVpapb1TK2cNm+1ifM/vbiBpoy4KHc6d5vabAgaafzlWXdE58YeH/4wFebc1By3hiERaorQnqhMjsCO5efnmWUjd00PGQWFow/kJm8MwRE7WiX4AtUOlgIZbDF4OJBuwHplhuUPKzevCFT/it6b4XSUZcI/RWQz0GQ1Dp8JW76fvIx9+qbT8nTJyJyP7C85n5bIukxIcLnJI6WoA36lVhaXM+c25DWLYthizWr2LPHFyMliBdEI8qwyq8Q8eAIXe+xs7J7bibxex8d1RPwAhW/1blL3ihayKbLi+rahzUpavxShgbyMko7gyvbVgJYwZwtpIOJliBSxplj1QtmQjWLafVJ10JCzl2z71dwyEwq0Ynwvnt8EUqZdSyny6owvUOO+pyjwC8Skb4xCuoWmHJDtDlvxtuMj1Rnkw9SqvBV+Lu5u6JSrPqLTPd8H8//M0NIvHShHN7U31Rl9jsODSGVzIyO6zp+bi+TfWFGfcu6ixYE03v/UFBjFoYtEsAOfVLmosqTnhn7aJoQ9e8Zccquzbv6L5XETxK9JEx08WFSCacBQtYIHXWYTGNuEC7pqqdcuIfg/JCj2CzBGVs0KoBluiZYxUT11EaJaPJQ5jKn+JVZip8LelQGP+FZyIMBs=
  - secure: HXnxlp+F94dENv3FCAVNzZ1iCn2xQymv1oLoOYChY7sIntMY/8JhIeR8EuOuGR2br6Mz522q8VocrK98eT23eeF36qDFqXT048aYf5SnK1J59L27V+DKtEFbDNy6No2lY5VCUuXEQAtFGU77+sPjwqrUkOeksc87BbCf+xkfdo8d36oRMhHd5Vh3MkZbQlgQmHuRe8NsamD4heO2cg9jlon6Uxcq1RAWh7OSUMlS+rtZNJGDUcNv+ZU66JQH0Na8hoWVf5kvmdbLXLfBoRz3TmHSVjfdo1Nk1zBB9HtilsWsa3AJx5Ys+CO2VoXZj3H2tBxYjkF77OhmuzgCnYtcdhPqbyK0AEzOVL37QtKmBfRRGjCnTlwVgfvcyP/cq6TmdoZimXFh/Q60gd6RnPq/T60G8cytD3d/bN7fPJr7buYydVOx/rHMuvEyiGeT3WastfShpcNSoYkqK2z6HzSOkJKw0gqv20WwsElA5uy2uMrMC5oevIpCWj04NmCxWCyKUPatZ+zfRVJ0+lRSScQAwsWZJSy5St/0y1JBb8dTGoUm+xADdfkR5O9GwK/OLSF9JRPmFoTpHVA3BEOvDnrkVbo2rOfburPQWPdTX1BNM9qfgMK+qICWr+FOHB2wg7sxzRBr+TQZtNvGxWbSRJmHmHtUL+Xk1iImfDAISslvGRo=
branches:
  only:
  - master
before_install:
- eval "$(GIMME_GO_VERSION=1.8.3 gimme)"
- go get github.com/pulumi/travisqueue
- travisqueue start
- nvm install node v8.11.4
install:
- bundle install --path vendor/bundle
- bundle exec chromedriver-update
- yarn install
- curl -L https://codeclimate.com/downloads/test-reporter/test-reporter-latest-linux-amd64
  > ./cc-test-reporter
- chmod +x ./cc-test-reporter
before_script:
- cp config/database.yml.travis config/database.yml
- psql -c 'create database travis_ci_test;' -U postgres
script:
- bundle exec rails webpacker:compile
- bundle exec rake db:schema:load
- "./cc-test-reporter before-build"
- bundle exec rspec spec
- "./cc-test-reporter format-coverage -t simplecov -o coverage/codeclimate.simplecov.json"
- yarn test
- "./cc-test-reporter format-coverage -t lcov -o coverage/codeclimate.lcov.json"
- "./cc-test-reporter sum-coverage coverage/codeclimate.*.json"
- "./cc-test-reporter upload-coverage"
- bundle exec bundle-audit check --update
deploy:
  provider: heroku
  api_key: "$HEROKU_AUTH_TOKEN"
  app:
    master: practicaldev
  run:
  - rake db:migrate
after_deploy:
- bash after_deploy.sh
after_script:
- travisqueue finish
notifications:
  slack:
    on_pull_requests: false
    rooms:
      secure: vzIee4jDgPSRY4szZPdD/jW7YW4GzGqo5NoLV9Exz9TBoWH9UqJnc0TOb2YN84Ys5baRK7LOqxpfp8kFveZkrKGi7/ypeEJlpc9E5UqVh/bwQhvOGrKEg1fvNXbARRnO/sJ49o1CMvroMWvt3GurzuuY9Qu2r+3NBjn9aVwLnLzXsBuF+m2lLoeSkHnW13OC73EeJMsse6JBoCe3gp/srDwISp9+MU+sEAPaY333WK9Vk1kdG7D5oUIuT7743airLRiyWiNUCD1450g864628CEOEZKJAAtqk6kTmvwB91DJMnhD/XhMm4H21kd54YHy0fhqzcG8hYd1lDZuUfrOBfpdEtfnpcRwMyMpY+FPPHXkHhck3OiLJnzkV4L+Lr5W/RvDJ63Ye2nxT4hOItLWaoZWax/LhoIrhZjgYBc4JhiGRQJ8m2HzoRyceeG9Y80vayGVN7y46sjYHP5NHRI36qmJipneDRAJklBTXLdYATvVM/6Mh9B7+H/nBGR6UVJLBC/txi2C8rZRjKBZ/i9e+q/MZs0UEvOuvbz9BXKU08rI+rarJqH3h5Ji9G/k3M0mQ8EfvadabA9lu+gNUAAnq+vwLETweKvfbRpDQjVBKnWsOJoUl9aarfkBn3lhQE8fxZJT/GchLGZPx/CWUE4o1OhliBA9avJ7WINyYStM4Mc=
