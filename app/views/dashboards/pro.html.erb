<div class="dashboard-container pro-container" id="user-dashboard">
  <a href="/dashboard" class="rounded-btn">Back to Dashboard</a>
  <% current_active_view = @dashboard.user_or_org.class.name %>
  <% if current_active_view == "Organization" %>
    <a class="rounded-btn" href="/dashboard/pro">
      View Your Pro Dashboard
    </a>
  <% elsif current_active_view == "User" && @dashboard.user_or_org.organization_id %>
    <a class="rounded-btn" href="/dashboard/pro/org/<%= @dashboard.user_or_org.organization_id %>">
      View <%= @dashboard.user_or_org.organization.name %> Dashboard
    </a>
  <% end %>
  <section class="header-card card">
    <h1 class="pro-header">Pro Dashboard <%= "for #{@dashboard.user_or_org.name}" if current_active_view == "Organization" %></h1>
    <p>Welcome to the pro dashboard which shows in-depth user metrics so that authors can make data-driven decisions about the developer ecosystem.</p>
    <p>This dashboard will highlight deep insights especially relevant to developer relations authors and serious bloggers.</p>
  </section>
  <div class="summary-stats">
    <div class="card">
      <h4>Reactions this week</h4>
      <div class="featured-stat">
        <%= @dashboard.data_by_time(:this_week, :reaction).count %>
      </div>
      <% week_reaction_rate = @dashboard.data_by_time(:this_week, :reaction).count.to_f / @dashboard.data_by_time(:last_week, :reaction).count.to_f %>
       <div class="stat-percentage" style="color: <%= week_reaction_rate > 1 ? "green" : "red" %>">
        <%= week_reaction_rate > 1 ? "\u25b2" : "\u25BC" %> <%= @dashboard.data_by_time(:last_week, :reaction).count.positive? ? (week_reaction_rate * 100).round(2) : "infinity " %>%
      </div>
    </div>
    <div class="card">
      <h4>Reactions this month</h4>
      <div class="featured-stat">
        <%= @dashboard.data_by_time(:this_month, :reaction).count %>
      </div>
      <% month_reaction_rate = @dashboard.data_by_time(:this_month, :reaction).count.to_f / @dashboard.data_by_time(:this_month, :reaction).count.to_f %>
       <div class="stat-percentage" style="color: <%= month_reaction_rate > 1 ? "green" : "red" %>">
        <%= month_reaction_rate > 1 ? "\u25b2" : "\u25BC" %> <%= @dashboard.data_by_time(:this_month, :reaction).count.positive? ? (month_reaction_rate * 100).round(2) : "infinity " %>%
      </div>
    </div>
    <div class="card">
      <h4>New followers this week</h4>
      <div class="featured-stat">
        <%= @dashboard.data_by_time(:this_week, :follow).count %>
      </div>
      <% week_followers_rate = @dashboard.data_by_time(:this_week, :follow).count.to_f / @dashboard.data_by_time(:last_week, :follow).count.to_f %>
       <div class="stat-percentage" style="color: <%= week_followers_rate > 1 ? "green" : "red" %>">
        <%= week_followers_rate > 1 ? "\u25b2" : "\u25BC" %> <%= @dashboard.data_by_time(:last_week, :follow).count.positive? ? (week_followers_rate * 100).round(2) : "infinity " %>%
      </div>
    </div>
    <div class="card">
      <h4>New followers this month</h4>
      <div class="featured-stat">
        <%= @dashboard.data_by_time(:this_month, :follow).count %>
      </div>
      <% month_followers_rate = @dashboard.data_by_time(:this_month, :follow).count.to_f / @dashboard.data_by_time(:last_month, :follow).count.to_f %>
       <div class="stat-percentage" style="color: <%= month_followers_rate > 1 ? "green" : "red" %>">
        <%= month_followers_rate > 1 ? "\u25b2" : "\u25BC" %> <%= @dashboard.data_by_time(:last_month, :follow).count.positive? ? (month_followers_rate * 100).round(2) : "infinity " %>%
      </div>
    </div>
    <div class="card">
      <h4>New comments this week</h4>
      <div class="featured-stat">
        <%= @dashboard.data_by_time(:this_week, :comment).count %>
      </div>
      <% week_comments_rate = @dashboard.data_by_time(:this_week, :comment).count.to_f / @dashboard.data_by_time(:last_week, :comment).count.to_f %>
       <div class="stat-percentage" style="color: <%= week_comments_rate > 1 ? "green" : "red" %>">
        <%= week_comments_rate > 1 ? "\u25b2" : "\u25BC" %> <%= @dashboard.data_by_time(:last_week, :comment).count.positive? ? (week_comments_rate * 100).round(2) : "infinity " %>%
      </div>
    </div>
    <div class="card">
      <h4>New comments this month</h4>
      <div class="featured-stat">
        <%= @dashboard.data_by_time(:this_month, :comment).count %>
      </div>
      <% month_comments_rate = @dashboard.data_by_time(:this_month, :comment).count.to_f / @dashboard.data_by_time(:last_month, :comment).count.to_f %>
       <div class="stat-percentage" style="color: <%= week_comments_rate > 1 ? "green" : "red" %>">
        <%= month_comments_rate > 1 ? "\u25b2" : "\u25BC" %> <%= @dashboard.data_by_time(:last_month, :comment).count.positive? ? (month_comments_rate * 100).round(2) : "infinity " %>%
      </div>
    </div>
  </div>
  <div class="graphs">
    <div class="card">
      <h2>Reactions Summary ‚ù§ü¶Ñüîñ</h2>
      <div class="charts-container">
        <canvas
          id="reactionsChart"
          data-labels="<%= @dashboard.data_by_time(:this_week, :reaction).formatted_dates %>"
          data-total-count="<%= @dashboard.data_by_time(:this_week, :reaction).total_per_day %>"
          data-total-likes="<%= @dashboard.data_by_time(:this_week, :reaction).total_by_type_per_day(type: "Reaction", category: "like") %>"
          data-total-unicorns="<%= @dashboard.data_by_time(:this_week, :reaction).total_by_type_per_day(type: "Reaction", category: "unicorn") %>"
          data-total-readinglist="<%= @dashboard.data_by_time(:this_week, :reaction).total_by_type_per_day(type: "Reaction", category: "readinglist") %>">
        </canvas>
      </div> 
    </div>
    <div class="card">
      <h2>Comments Summary üí¨</h2>
      <div class="charts-container">
        <canvas
          id="commentsChart"
          data-labels="<%= @dashboard.data_by_time(:this_week, :comment).formatted_dates %>"
          data-total-count="<%= @dashboard.data_by_time(:this_week, :comment).total_per_day %>">
        </canvas>
      </div>
    </div>
    <div class="card" style="display: none;">
      <div class="charts-container">
          <canvas
            id="followsChart"
            data-labels="<%= @dashboard.data_by_time(:this_week, :follow).formatted_dates %>"
            data-total-count="<%= @dashboard.data_by_time(:this_week, :follow).total_per_day %>">
          </canvas>
        </div>
    </div>
    <%= javascript_pack_tag "proCharts", defer: true %>
  </div>
  <div class="card">
    <h2>View Count üëÄ</h2>
    <h3>Total views across all posts: <%= @dashboard.total_views %></h3>
    <div class="recent-reactors-container" style="<%= "display: none;" %>">
      <% @dashboard.article_data.each do |article| %>
        <div class="single-article">
          <h2><a href="<%= article.path %>"><%= article.title %></a></h2>
          <p>Total views: <%= article.organic_page_views_count + article.page_views_count %></p>
          <p>Organic views in the past week: <%= article.organic_page_views_past_week_count %></p>
          <p>Organic views in the past month: <%= article.organic_page_views_past_month_count %></p>
          <p>
            Tags used:
            <% article.decorate.cached_tag_list_array.each do |tag| %>
              <a href="/t/<%= tag %>"><span class="tag">#<%= tag %></span></a>
            <% end %>
          </p>
        </div>
      <% end %>
    </div>
  </div>
  <h2>Activity</h2>
  <h3>People who recently reacted ‚ù§ü¶Ñüîñ to your content:</h3>
  <div class="recent-reactors-container">
    <% @dashboard.reactors.each do |user| %>
      <div class="single-article">
        <a href="<%= user.path %>" class="block-link">
          <h2>
            <img alt="<%= user.username %> profile image" src="<%= ProfileImage.new(user).get(60) %>" />
            <%= user.name %>
            <span class="dashboard-username">@<%= user.username %></span>
          </h2>
        </a>
      </div>
    <% end %>
  </div>
</div>
