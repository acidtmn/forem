<% decorated_comment = comment.decorate %>
<div
  id="comment-node-<%= comment.id %>"
  class="comment mb-6 single-comment-node <%= comment_class(comment, is_view_root: is_view_root) %> <%= "flat-node" if comment.depth > 3 %> comment-deep-<%= comment.depth %> <%= "low-quality-comment" if decorated_comment.low_quality %>"
  data-comment-id="<%= comment.id %>"
  data-comment-author-id="<%= comment_user_id_unless_deleted comment %>"
  data-content-user-id="<%= comment_user_id_unless_deleted comment %>">
  <div class="flex items-start mb-1">
    <% if comment.deleted %>
      <div class="inner-comment comment__details pl-4">
        Comment deleted
      </div>
    <% else %>
      <a href="/<%= comment.user.username %>" class="shrink-0 crayons-avatar <% if comment.depth == 0 %>crayons-avatar--l<% end %> mt-2">
        <img class="crayons-avatar__image" width="32" height="32" src="<%= Images::Profile.call(comment.user.profile_image_url, length: 50) %>" alt="<%= comment.user.username %> profile image" />
      </a>

      <div class="inner-comment comment__details pl-2 flex-1">
        <% if decorated_comment.low_quality %>
          <div class="low-quality-comment-marker">
            <%= image_tag(Images::Optimizer.call(SiteConfig.mascot_image_url, width: 50, height: 50, crop: "imagga_scale"), class: "sloan", alt: "Sloan, the sloth mascot", loading: "lazy") %>
            Comment marked as low quality/non-constructive by the community
            <a href="/code-of-conduct">View code of conduct</a>
          </div>
        <% end %>

        <% if comment.hidden_by_commentable_user %>
          <div class="low-quality-comment-marker">
            Comment hidden by post author - thread only visible in this permalink
          </div>
        <% end %>

        <div class="comment__content p-2 bg-base-0 radius-default">
          <header class="flex items-center fs-s px-3">
            <a href="/<%= comment.user.username %>" class="crayons-link crayons-link--secondary flex items-center fw-medium">
              <%= comment.user.name %>
              <% if commentable_author_is_op?(commentable, comment) %>
                <span class="crayons-tooltip inline-block" data-tooltip="<%= get_ama_or_op_banner(commentable) %>">
                  <%= inline_svg_tag("small-medal.svg", aria: true, class: "crayons-icon", title: get_ama_or_op_banner(commentable)) %>
                </span>
              <% end %>
            </a>

            <%= render "comments/comment_date", decorated_comment: decorated_comment %>

            <div class="ml-auto -mr-3 relative hidden">
              <button class="dropbtn crayons-btn crayons-btn--s crayons-btn--ghost-dimmed crayons-btn--icon" aria-label="Toggle dropdown menu">
                <%= inline_svg_tag("overflow-horizontal.svg", aria: true, class: "crayons-icon dropdown-icon", title: "Dropdown menu") %>
              </button>
              <div class="dropdown">
                <div class="crayons-dropdown p-1 right-1 left-1 s:right-0 s:left-auto fs-base">
                  <a href="<%= comment.path %>" class="crayons-link crayons-link--block">Permalink</a>
                  <span class="comment-actions hidden" data-user-id="<%= comment.user_id %>" data-action="settings-button" data-path="<%= comment.path %>/settings">
                  </span>
                  <% action = comment.hidden_by_commentable_user ? "Unhide" : "Hide" %>
                  <span class="comment-actions hidden" data-action="hide-button" data-commentable-user-id="<%= commentable.user_id %>" data-user-id="<%= comment.user_id %>" style="display: none; width: 100%;">
                    <a href="#" class="crayons-link crayons-link--block hide-comment" data-hide-type="<%= action.downcase %>" data-comment-id="<%= comment.id %>">
                      <%= action %>
                    </a>
                  </span>
                  <span class="mod-actions hidden mod-actions-comment-button" data-path="<%= comment.path %>/mod"></span>
                  <span class="report-abuse-link-wrapper" data-path="/report-abuse?url=<%= comment_url(comment) %>"></span>
                  <span class="current-user-actions hidden"></span>
                </div>
              </div>
            </div>
          </header>

          <div class="comment__body text-styles text-styles--secondary mt-2 mb-4 body px-3">
            <%= comment.safe_processed_html %>
          </div>
        </div>

        <footer class="flex items-center pt-1">
          <button
            class="crayons-btn crayons-btn--ghost crayons-btn--icon-left crayons-btn--s mr-1 reaction-like inline-flex reaction-button"
            id="button-for-comment-<%= comment.id %>"
            data-comment-id="<%= comment.id %>"
            title="heart">
            <%= inline_svg_tag("small-heart.svg", aria: true, class: "crayons-icon reaction-icon not-reacted", title: "Favorite heart outline button") %>
            <%= inline_svg_tag("small-heart-filled.svg", aria: true, class: "crayons-icon reaction-icon--like reaction-icon reacted", title: "Favorite heart outline button") %>
            <span class="hidden m:inline-block">Like</span>
          </button>

          <div
            class="actions mb-0 inline-flex"
            data-comment-id="<%= comment.id %>"
            data-path="<%= commentable.path %>/comments/<%= comment.id_code_generated %>">
            <a
              class="crayons-btn crayons-btn--ghost crayons-btn--s crayons-btn--icon-left toggle-reply-form mr-1 inline-flex"
              href="#<%= commentable.path %>/comments/new/<%= comment.id_code_generated %>"
              rel="nofollow">
              <%= inline_svg_tag("small-comment.svg", aria: true, class: "crayons-icon reaction-icon not-reacted", title: "Comment button") %>
              <%= inline_svg_tag("small-comment-filled.svg", aria: true, class: "crayons-icon reaction-icon--comment reaction-icon reacted", title: "Comment button") %>
              <span class="hidden m:inline-block">Reply</span>
            </a>
          </div>
        </footer>
      </div>
    <% end %>
  </div>
  <%= subtree_html %>
</div>
