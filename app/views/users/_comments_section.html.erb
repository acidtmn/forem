<% cache("user-profile-comments-#{@user.last_comment_at}-#{@user.id}-#{@comments.size}", expires_in: 2.days) do %>
  <div class="profile-comment-card crayons-card mt-2 m:mt-0 mb-2">
    <% if @comments.present? %>
      <% if params[:view] == "comments" %>
        <div class="crayons-card__header">
          <h4 class="crayons-card__headline">
            <% if @user.comments_count > 250 %>
              Last 250 comments
            <% else %>
              All <%= @user.comments_count %> comments
            <% end %>
          </h4>
          <div class="crayons-card__actions">
            <a href="<%= @user.path %>" class="crayons-link--branded fs-base">
              View all activity
            </a>
          </div>
        </div>
      <% else %>
        <div class="crayons-card__header">
          <h4 class="crayons-card__headline">
            Recent comments
          </h4>
        </div>
      <% end %>
    <% end %>
    <% @comments.each do |comment| %>
      <% if comment.commentable.present? && comment.commentable.published && !comment.deleted %>
        <a href="<%= comment.path %>" class="profile-comment-row ">
          <span class="fw-bold fs-base">
            <%= comment.commentable.title %>
          </span>
          <div class="inline-flex items-center gap-2">
            <div class="fs-s comment-preview">
              <div class="crayons-avatar crayons-avatar--m mr-1">
                <img alt="<%= @user.username %>%" src="<%= @user.profile_image_90 %>" class="crayons-avatar__image" />
              </div>
              <span class="fw-medium mr-1">
                <%= @user.name %>
              </span>
              <span class="color-base-80">
                <%= truncate(strip_tags(comment.processed_html), length: 64).html_safe %>
              <span>
            </div>
            <span class="color-base-60 fs-s comment-date whitespace-nowrap">
              <time datetime="<%= comment.decorate.published_timestamp %>"><%= comment.readable_publish_date %></time>
            </span>
          </div>
        </a>
      <% end %>
    <% end %>
    <% if params[:view] != "comments" && @user.comments_count > 250 %>
      <div class="pt-3 pl-4 pb-3 pr-4">
        <a href="<%= @user.path %>/comments" class="fs-base">
          View last 250 Comments
        </a>
      </div>
    <% elsif params[:view] != "comments" && @user.comments_count > 8 %>
      <div class="pt-3 pl-4 pb-3 pr-4">
        <a href="<%= @user.path %>/comments" class="fs-base">
          View all <%= @user.comments_count %> comments
        </a>
      </div>
    <% end %>
  </div>
<% end %>
