<% title @user.name %>

<%= render "shared/payment_pointer", user: @user %>

<%= content_for :page_meta do %>
  <%= render "users/meta" %>
<% end %>

<% unless internal_navigation? || user_signed_in? %>
  <script type="application/ld+json">
    <%= @user_json_ld.to_json.html_safe %>
  </script>
<% end %>
<% cache "main-user-profile-header-area-#{@user.id}-#{@user.profile_updated_at}-#{user_signed_in?}", expires_in: 10.days do %>
  <style>
    .profile-header {
      --profile-brand-color: <%= HexComparer.new([user_colors(@user)[:bg], user_colors(@user)[:text]]).brightness(0.88) %>;
    }
  </style>

  <div class="crayons-layout">
    <header class="profile-header crayons-card branded-7">
      <div class="profile-header__top">
        <div class="profile-header__pic">
          <span class="crayons-avatar crayons-avatar--3xl">
            <img src="<%= ProfileImage.new(@user).get(width: 320) %>" width="128" height="128" alt="<%= @user.name %> profile picture" class="crayons-avatar__image">
          </span>
        </div>

        <div class="profile-header__details">
          <div class="flex items-start justify-between">
            <div>
              <h1 class="fs-4xl lh-tight mb-4 fw-heavy"><%= @user.name %></h1>
              <p class="fs-l color-base-90 mb-4"><%= @user.summary.presence || ["404 bio not found"].sample %></p>
            </div>
            <div class="flex pl-6">
              <% if user_signed_in? %>
                <a href="/connect/@<%= @user.username %>" class="hidden mr-2" id="user-connect-redirect">
                  <button class="chat-action-button crayons-btn crayons-btn--outlined hidden" id="modal-opener">Chat</button>
                </a>
              <% end %>
              <button id="user-follow-butt" class="crayons-btn whitespace-nowrap follow-action-button user-profile-follow-button" data-info='{"id":<%= @user.id %>,"className":"<%= @user.class.name %>"}'>Follow</button>
            </div>
          </div>

          <div class="profile-header__meta">
            <div class="mb-2 flex items-center">
              <a href="#">@<%= @user.username %></a><span class="profile-header__meta__divider">&bull;</span>
              <% if @user.email_public %>
                <a href="mailto:<%= @user.email %>"><%= @user.email %></a><span class="profile-header__meta__divider">&bull;</span>
              <% end %>
              <div class="flex items-center">
                <% if @user.twitter_username? %>
                  <a href="https://twitter.com/<%= @user.twitter_username %>" target="_blank" rel="noopener me" class="px-1 mx-1 align-middle inline-block">
                    <%= inline_svg_tag("twitter.svg", class: "crayons-icon", aria: true, title: "Twitter logo") %>
                  </a>
                <% end %>
                <% if @user.github_username? %>
                  <a href="https://github.com/<%= @user.github_username %>" target="_blank" rel="noopener me" class="px-1 mx-1 align-middle inline-block">
                    <%= inline_svg_tag("github.svg", class: "crayons-icon", aria: true, title: "GitHub logo") %>
                  </a>
                <% end %>
                <% if @user.mastodon_url? %>
                  <a href="<%= @user.mastodon_url %>" target="_blank" rel="noopener me" class="px-1 mx-1 align-middle inline-block">
                    <%= inline_svg_tag("mastodon.svg", class: "crayons-icon", aria: true, title: "Mastodon logo") %>
                  </a>
                <% end %>
                <% if @user.facebook_url? %>
                  <a href="<%= @user.facebook_url %>" target="_blank" rel="noopener me" class="px-1 mx-1 align-middle inline-block">
                    <%= inline_svg_tag("facebook.svg", class: "crayons-icon", aria: true, title: "Facebook logo") %>
                  </a>
                <% end %>
                <% if @user.youtube_url? %>
                  <a href="<%= @user.youtube_url %>" target="_blank" rel="noopener me" class="px-1 mx-1 align-middle inline-block">
                    <%= inline_svg_tag("youtube.svg", class: "crayons-icon", aria: true, title: "Youtube logo") %>
                  </a>
                <% end %>
                <% if @user.linkedin_url? %>
                  <a href="<%= @user.linkedin_url %>" target="_blank" rel="noopener me" class="px-1 mx-1 align-middle inline-block">
                    <%= inline_svg_tag("linkedin.svg", class: "crayons-icon", aria: true, title: "LinkedIn logo") %>
                  </a>
                <% end %>
                <% if @user.behance_url? %>
                  <a href="<%= @user.behance_url %>" target="_blank" rel="noopener me" class="px-1 mx-1 align-middle inline-block">
                    <%= inline_svg_tag("behance.svg", class: "crayons-icon", aria: true, title: "Behance logo") %>
                  </a>
                <% end %>
                <% if @user.stackoverflow_url? %>
                  <a href="<%= @user.stackoverflow_url %>" target="_blank" rel="noopener me" class="px-1 mx-1 align-middle inline-block">
                    <%= inline_svg_tag("stackoverflow.svg", class: "crayons-icon", aria: true, title: "StackOverflow logo") %>
                  </a>
                <% end %>
                <% if @user.dribbble_url? %>
                  <a href="<%= @user.dribbble_url %>" target="_blank" rel="noopener me" class="px-1 mx-1 align-middle inline-block">
                    <%= inline_svg_tag("dribbble.svg", class: "crayons-icon", aria: true, title: "Dribbble logo") %>
                  </a>
                <% end %>
                <% if @user.medium_url? %>
                  <a href="<%= @user.medium_url %>" target="_blank" rel="noopener nofollow me" class="px-1 mx-1 align-middle inline-block">
                    <%= inline_svg_tag("medium.svg", class: "crayons-icon", aria: true, title: "Medium logo") %>
                  </a>
                <% end %>
                <% if @user.gitlab_url? %>
                  <a href="<%= @user.gitlab_url %>" target="_blank" rel="noopener nofollow me" class="px-1 mx-1 align-middle inline-block">
                    <%= inline_svg_tag("gitlab.svg", class: "crayons-icon", aria: true, title: "GitLab logo") %>
                  </a>
                <% end %>
                <% if @user.instagram_url? %>
                  <a href="<%= @user.instagram_url %>" target="_blank" rel="noopener nofollow me" class="px-1 mx-1 align-middle inline-block">
                    <%= inline_svg_tag("instagram.svg", class: "crayons-icon", aria: true, title: "Instagram logo") %>
                  </a>
                <% end %>
                <% if @user.twitch_username? %>
                  <a href="<%= twitch_live_stream_path(username: @user.username) %>" class="px-1 mx-1 align-middle inline-block <% if @user.currently_streaming_on_twitch? %>color-accent-success<% end %>">
                    <%= inline_svg_tag("twitch.svg", class: "crayons-icon", id: "icon-twitch", aria: true, title: "Twitch logo") %>
                  </a>
                <% elsif @user.twitch_url? %>
                  <a href="<%= @user.twitch_url %>" target="_blank" rel="noopener nofollow me" class="px-1 mx-1 align-middle inline-block">
                    <%= inline_svg_tag("twitch.svg", class: "crayons-icon", aria: true, title: "Twitch logo") %>
                  </a>
                <% end %>
                <% if @user.website_url? %>
                  <a href="<%= @user.website_url %>" target="_blank" rel="noopener nofollow me" class="px-1 mx-1 align-middle inline-block">
                    <%= inline_svg_tag("external.svg", class: "crayons-icon", aria: true, title: "External link icon") %>
                  </a>
                <% end %>
              </div>
            </div>

            <div class="flex items-center">
              <% if @user.location.present? %>
                <span class="flex items-center mr-6">
                  <%= inline_svg_tag("location.svg", aria: true, class: "crayons-icon mr-2", title: "Location") %>
                  <%= @user.location %>
                </span>
              <% end %>

              <span class="flex items-center">
                <%= inline_svg_tag("cake.svg", aria: true, class: "crayons-icon mr-2", title: "Joined") %>
                Joined on&nbsp;
                <%= local_date(@user.created_at) %>
              </span>
            </div>
          </div>
        </div>
      </div>
      <%= render "users/metadata" %>
    </header>
  </div>

  <br><br><br><br><br><br><br><br><br><br><br><br>

  <div class="user-profile-header" style="<%= user_colors_style(@user) %>">
    <div class="modal" style="display: none">
      <div class="overlay"></div>
      <div class="modal-content " id="new-message-modal">
        <button title="Close" class="close-modal">X</button>
        <% if @user.inbox_guidelines.present? %>
          <p><b>@<%= @user.username %>'s guidelines:</b></p>
          <p><%= @user.inbox_guidelines %></p>
        <% end %>
        <form id="new-message-form" class="message-form" data-info='{"id":<%= @user.id %>,"className":"<%= @user.class.name %>","username":"<%= @user.username %>", "showChat":"<%= @user.inbox_type %>"}'>
          <textarea id="new-message" rows="4" cols="70" placeholder="Enter your message here..."></textarea>
          <button type="submit" value="Submit" class="submit-message cta">SEND</button>
        </form>
        <p>
          <em>All private interactions <b>must</b> abide by the <a href="/code-of-conduct">code of conduct</a></em>
        </p>
      </div>
    </div>
    <%= render "articles/user_metadata", context: "profile" %>
    <div class="profile-dropdown" data-username="<%= @user.username %>">
      <button id="user-profile-dropdown">
        <%= image_tag("overflow-horizontal.svg", class: "dropdown-icon", alt: "Toggle dropdown menu") %>
      </button>
      <div id="user-profile-dropdownmenu" class="profile-dropdownmenu">
        <button id="user-profile-dropdownmenu-block-button" data-profile-user-id="<%= @user.id %>" class="block-button" type="button">Block @<%= @user.username %></button>
        <% if user_signed_in? %>
          <%= javascript_packs_with_chunks_tag "profileDropdown", defer: true %>
        <% end %>
        <span class="report-abuse-link-wrapper" data-path="/report-abuse?url=<%= user_url(@user) %>"></span>
      </div>
    </div>
  </div>
<% end %>

<div class="home sub-home" id="index-container"
     data-params="<%= params.merge(user_id: @user.id, class_name: "Article", sort_by: "published_at", sort_direction: "desc").to_json(only: %i[tag user_id q class_name sort_by sort_direction]) %>" data-which="<%= @list_of %>"
     data-tag=""
     data-feed="<%= params[:timeframe] || "base-feed" %>"
     data-articles-since="0">
  <%= render "users/sidebar" %>
  <div class="articles-list" id="articles-list">
    <div class="on-page-nav-controls user-nav-controls" id="on-page-nav-controls">
      <button class="on-page-nav-butt on-page-nav-butt-left" id="on-page-nav-butt-left" aria-label="nav-button-left">
        <div class="crayons-icon nav-icon">
          <%= SiteConfig.left_navbar_svg_icon.html_safe %>
        </div>
      </button>
      <button class="on-page-nav-butt on-page-nav-butt-right" style="margin-top:-1px;" id="on-page-nav-butt-right" aria-label="nav-button-right">
        <img style="height:28px;width:28px;" src="<%= asset_path "ribbon.svg" %>" alt="right-sidebar-nav">
      </button>
    </div>
    <div class="substories" id="substories">
      <% if params[:view] == "comments" %>
        <%= render "users/comments_section" %>
      <% elsif @stories.any? || @comments.any? || @pinned_stories.any? %>
        <%= render "users/main_feed" %>
      <% end %>
    </div>
    <div class="loading-articles" id="loading-articles">
      loading...
    </div>
  </div>
  <% cache "user-profile-sidebar-additional-#{@user.id}-#{@user.github_repos_updated_at}-#{@user.badge_achievements_count}-#{@user.organization_info_updated_at}", expires_in: 2.days do %>
    <%= render partial: "users/sidebar_additional", locals: { repositories: @github_repositories } %>
  <% end %>
</div>

<%= render "stories/narrow_nav_menu" %>
<%= render "stories/stories_list_script" %>
