<header class="mb-6">
  <h2 class="fs-2xl s:fs-3xl">Profile fields</h2>
</header>

<div class="crayons-card grid p-6 mb-6 gap-1">
  <h4 class="mb-4">Create a field</h4>
  <%= form_for [:admin, ProfileField.new], html: { class: "inline-form" } do |form| %>
    <%= render "group_form",
               form: form,
               select_option_tags: options_for_select(ProfileField.distinct.pluck(:group)),
               select_options: {
                 include_blank: "Choose an existing group",
                 class: "form-control selectpicker profile__group-dropdown"
               },
               toggle_text: "or create a new group" %>
    <div class="form-group">
      <%= render "form", form: form %>
      <%= form.submit "Create New Profile Field", class: "btn btn-primary" %>
    </div>
  <% end %>
</div>

<% @grouped_profile_fields.each do |group, fields| %>
  <% group_attribute = group.gsub(/\s+/, "_") %>

  <div class="crayons-card">
    <div class="card-header flex items-center" id="<%= group_attribute %>Header" data-toggle="collapse"
      data-target="#<%= group_attribute %>BodyContainer" aria-expanded="false" aria-controls="<%= group_attribute %>BodyContainer">
      <h4><%= group %></h4>
      <button class="btn btn-secondary ml-auto" type="button">Toggle <%= group %></button>
    </div>
    <div id="<%= group_attribute %>BodyContainer" class="collapse hide p-4" aria-labelledby="<%= group %>Header">
      <% fields.each do |field| %>
        <div class="crayons-card  mb-4">
          <%= render partial: "admin/configs/card_header",
                     locals: {
                       header: field.label,
                       state: "collapse",
                       target: "#{field.attribute_name}_container",
                       expanded: "false"
                     } %>
          <div id="<%= field.attribute_name %>_container" class="card-body collapse hide" aria-labelledby="<%= field.attribute_name %>_container">
            <div class="form-group grid gap-1">
              <%= form_for [:admin, field] do |form| %>
                <%= render "group_form",
                           form: form,
                           select_option_tags: options_for_select(ProfileField.distinct.pluck(:group), selected: field[:group]),
                           select_options: {
                             class: "form-control selectpicker profile__group-dropdown"
                           },
                           toggle_text: "or create a new group" %>
                <%= render "form", form: form %>
                <%= form.submit class: "btn btn-primary" %>
              <% end %>
              <%= button_to "Delete Profile Field", admin_profile_field_path(field), data: { confirm: "Are you sure?" }, method: :delete, class: "btn btn-secondary" %>
            </div>
          </div>
        </div>
      <% end %>
    </div>
  </div>
<% end %>
