<%= javascript_packs_with_chunks_tag "admin/members/memberControls", defer: true %>

<% if FeatureFlag.enabled?(:member_index_view) %>
  <% if params[:controller] == "admin/users" %>

    <!-- Small screen layout -->
    <div class="flex justify-between my-3 l:hidden">
      <div>
        <button id="expand-search-btn" class="c-btn c-btn--icon-alone" aria-label="Expand search" aria-expanded="false" aria-controls="search-users">
          <%= crayons_icon_tag("search", aria_hidden: true) %>
        </button>
        <button id="expand-filter-btn" class="c-btn c-btn--icon-alone" aria-label="Expand filter" aria-expanded="false" aria-controls="filter-users">
          <%= crayons_icon_tag("filter", aria_hidden: true) %>
        </button>
      </div>
      <%= paginate @users, theme: "admin", scope: @users, label: "Paginate users" %>
    </div>
    <div>
      <div id="search-users" class="hidden">
        <%= form_with url: admin_users_path, method: :get, local: true do |f| %>
          <div class="relative">
            <%= f.text_field :search, value: params[:search], class: "crayons-textfield mt-0", placeholder: "Search member...", aria: { label: "Search member by name, username, email, or Twitter/GitHub usernames" } %>
            <button type="submit" aria-label="Search" class="crayons-btn crayons-btn--ghost crayons-btn--s crayons-btn--icon-rounded absolute right-2 bottom-0 top-0 m-1">
              <%= crayons_icon_tag(:search, aria_hidden: true) %>
            </button>
          </div>
        <% end %>
      </div>
      <div id="filter-users" class="hidden">
        <%= form_with url: admin_users_path, method: :get, local: true do |f| %>
          <div class="crayons-field flex-row items-center gap-2">
            <%= f.select :role, options_for_select(Role::ROLES, params[:role]), { include_blank: true, prompt: "Filter by role..." }, class: "crayons-select" %>
            <%= f.submit "Filter", class: "c-btn c-btn--secondary mt-0" %>
          </div>
        <% end %>
      </div>
    </div>

    <!-- Larger screen layout -->
    <div class="hidden l:flex justify-between">
      <%= form_with url: admin_users_path, method: :get, local: true, class: "flex flex-col m:flex-row gap-3 m:items-center py-3" do |f| %>
        <div class="crayons-field flex-1 flex-row items-center gap-2 relative">
          <%= f.text_field :search, value: params[:search], class: "crayons-textfield mt-0", placeholder: "Search member...", aria: { label: "Search member by name, username, email, or Twitter/GitHub usernames" } %>
          <button type="submit" aria-label="Search" class="crayons-btn crayons-btn--ghost crayons-btn--s crayons-btn--icon-rounded absolute right-1 bottom-0 top-0 m-1">
            <%= crayons_icon_tag(:search, aria_hidden: true) %>
          </button>
        </div>
        <div class="crayons-field flex-row items-center gap-2">
          <%= f.select :role, options_for_select(Role::ROLES, params[:role]), { include_blank: true, prompt: "Filter by role..." }, class: "crayons-select mt-0" %>
        </div>
        <%= f.submit "Filter", class: "c-btn c-btn--secondary" %>
      <% end %>
      <%= paginate @users, theme: "admin", scope: @users, label: "Paginate users" %>
    </div>
  <% end %>

<% else %>
  <% if params[:controller] == "admin/users" %>
    <%= form_with url: admin_users_path, method: :get, local: true, class: "flex flex-col m:flex-row gap-3 m:items-center p-3" do |f| %>
      <div class="crayons-field flex-1 flex-row items-center gap-2">
        <%= f.label :search, class: "crayons-field__label whitespace-nowrap" %>
        <%= f.text_field :search, value: params[:search], class: "crayons-textfield mt-0", placeholder: "Name, username, email, or Twitter/GitHub usernames", aria: { label: "Filter by name, username, email, or Twitter/GitHub usernames" } %>
      </div>
      <div class="crayons-field flex-row items-center gap-2">
        <%= f.label :role, "Filter by Role", class: "crayons-field__label whitespace-nowrap" %>
        <%= f.select :role, options_for_select(Role::ROLES, params[:role]), { include_blank: true }, class: "crayons-select mt-0" %>
      </div>
      <%= f.submit "Filter", class: "c-btn c-btn--secondary" %>
    <% end %>
  <% end %>
  <% if params[:controller] == "admin/invitations" %>
    <%= link_to "New", new_admin_invitation_path, class: "c-cta self-end" %>
  <% end %>
<% end %>
