# Most of the things are optional. If you need to use a
# custom key, please create an application.yml for it

SET_DEFAULTS = ! Rails.env.production?
# or should it be ENV["RACK_ENV"] != "production" like below?
# enable_defaults! { ENV["RACK_ENV"] != "production" }

################################################
############## Basic configuration #############
################################################

def set_variable(name, data_type, default_value = nil)
  if SET_DEFAULTS && (! default_value.nil?)
    key = name.to_s # name will be a symbol, we need a String
    value = default_value.to_s # default_value may be a number, we need a String
    ENV[key] ||= value
  end
  variable name, data_type
end


# App domain + Protocol setting for development
set_variable :APP_DOMAIN, :String, "localhost:3000"
set_variable :APP_PROTOCOL, :String, "http://"
set_variable :COMMUNITY_NAME, :String, "DEV(local)"
set_variable :MAIN_SOCIAL_IMAGE, :String, "https://thepracticaldev.s3.amazonaws.com/i/6hqmcjaxbgbon8ydw93z.png"
set_variable :SITE_TWITTER_HANDLE, :String, "tbd"
set_variable :RATE_LIMIT_FOLLOW_COUNT_DAILY, :Integer, 500
set_variable :FAVICON_URL, :String, "favicon.ico"

# Logo
set_variable :LOGO_SVG, :String, ""

# Default staff account's id
set_variable :DEVTO_USER_ID, :Integer, 1

# Default site email
set_variable :DEFAULT_SITE_EMAIL, :String, "yo@dev.to"

# Service timeout length
set_variable :RACK_TIMEOUT_WAIT_TIMEOUT, :Integer, 100_000
set_variable :RACK_TIMEOUT_SERVICE_TIMEOUT, :Integer, 100_000

# Heroku release slug used to bust caches on deploys
set_variable :HEROKU_SLUG_COMMIT, :String, "Optional"

# Redis caching storage
set_variable :REDIS_URL, :String, "redis://localhost:6379"

# Redis sessions storage
set_variable :REDIS_SESSIONS_URL, :String, "redis://localhost:6379"
set_variable :SESSION_KEY, :String, "_Dev_Community_Session"
set_variable :SESSION_EXPIRY_SECONDS, :Integer, 1209600 # two weeks in seconds

################################################
############## 3rd Party Services ##############
################################################

# It's best if you have the following configured
# for more development experience

# Github for github related access
# (https://developer.github.com/v3/guides/basics-of-authentication/)
set_variable :GITHUB_KEY, :String, "Optional"
set_variable :GITHUB_SECRET, :String, "Optional"
set_variable :GITHUB_TOKEN, :String, "Optional"

# Twitter for normal twitter access
# (https://developer.twitter.com/en/docs/basics/authentication/guides/access-tokens)
set_variable :TWITTER_ACCESS_TOKEN, :String, "Optional"
set_variable :TWITTER_ACCESS_TOKEN_SECRET, :String, "Optional"
set_variable :TWITTER_KEY, :String, "Optional"
set_variable :TWITTER_SECRET, :String, "Optional"

################################################
######### Optional 3rd Party Services ##########
################################################

# Honeybadger for error tracking
# (https://docs.honeybadger.io/lib/ruby/getting-started/introduction.html)
set_variable :HONEYBADGER_API_KEY, :String, "Optional"
set_variable :HONEYBADGER_JS_API_KEY, :String, "Optional"

# Algolia for search (not optional)
# (https://www.algolia.com/doc/)
only_in_test = proc { ENV["RACK_ENV"] == "test" ? "test-test" : nil }
set_variable :ALGOLIASEARCH_API_KEY, :String, only_in_test
set_variable :ALGOLIASEARCH_APPLICATION_ID, :String, only_in_test
set_variable :ALGOLIASEARCH_SEARCH_ONLY_KEY, :String, only_in_test

# AWS for images storages
set_variable :AWS_ID, :String, "Optional"
set_variable :AWS_SECRET, :String, "Optional"
set_variable :AWS_BUCKET_NAME, :String, "Optional"

# AWS SDK
# (https://docs.aws.amazon.com/sdk-for-ruby/v3/developer-guide/setup-config.html)
set_variable :AWS_DEFAULT_REGION, :String, "us-east-1"
set_variable :AWS_SDK_KEY, :String, "Optional"
set_variable :AWS_SDK_SECRET, :String, "Optional"

# AWS for video storage
set_variable :AWS_S3_INPUT_BUCKET, :String, "Optional"
set_variable :AWS_S3_VIDEO_ID, :String, "Optional"
set_variable :AWS_S3_VIDEO_KEY, :String, "Optional"

# Buffer for sending to buffer
# (https://buffer.com/developers/api)
set_variable :BUFFER_ACCESS_TOKEN, :String, "Optional"
set_variable :BUFFER_FACEBOOK_ID, :String, "Optional"
set_variable :BUFFER_LINKEDIN_ID, :String, "Optional"
set_variable :BUFFER_PROFILE_ID, :Integer, 0
set_variable :BUFFER_TWITTER_ID, :String, "Optional"
set_variable :BUFFER_LISTINGS_PROFILE, :String, "Optional"

# Cloudinary for image resizing and cache??
# (https://cloudinary.com/documentation/rails_integration)
set_variable :CLOUDINARY_API_KEY, :String, "Optional"
set_variable :CLOUDINARY_API_SECRET, :String, "Optional"
set_variable :CLOUDINARY_CLOUD_NAME, :String, "Optional"
set_variable :CLOUDINARY_SECURE, :String, "Optional"

# HTML/CSS to Image for generating social preview images
# (https://docs.htmlcsstoimage.com/example-code/ruby)
set_variable :HCTI_API_USER_ID, :String, "Optional"
set_variable :HCTI_API_KEY, :String, "Optional"

# Dacast for streaming
# (https://www.dacast.com/video-api-documentation/)
set_variable :DACAST_STREAM_CODE, :String, "Optional"

# Fastly for edge caching
# (https://docs.fastly.com/api/)
set_variable :FASTLY_API_KEY, :String, "Optional"
set_variable :FASTLY_SERVICE_ID, :String, "Optional"

# Honeycomb for monitoring and observability
# (https://www.honeycomb.io/)
set_variable :HONEYCOMB_API_KEY, :String, ""

# Google analytic
# (https://developers.google.com/analytics/devguides/reporting/core/v4)
set_variable :GA_SERVICE_ACCOUNT_JSON, :String, "Optional"
set_variable :GA_TRACKING_ID, :String, "Optional"
set_variable :GA_OPTIMIZE_ID, :String, "Optional"
set_variable :GA_VIEW_ID, :String, "Optional"
set_variable :GA_FETCH_RATE, :Integer, 25

# Mailchimp for mails
# (https://mailchimp.com/developer/)
set_variable :MAILCHIMP_API_KEY, :String, "Optional-valid"
set_variable :MAILCHIMP_NEWSLETTER_ID, :String, "Optional"
set_variable :MAILCHIMP_SUSTAINING_MEMBERS_ID, :String, "Optional"
set_variable :MAILCHIMP_TAG_MODERATORS_ID, :String, "Optional"
set_variable :MAILCHIMP_COMMUNITY_MODERATORS_ID, :String, "Optional"

# Email digest frequency
set_variable :PERIODIC_EMAIL_DIGEST_MAX, :Integer, 0
set_variable :PERIODIC_EMAIL_DIGEST_MIN, :Integer, 2

# Pusher for DEV Connect/notfications
# (https://pusher.com/docs)
set_variable :PUSHER_APP_ID, :String, "Optional"
set_variable :PUSHER_CLUSTER, :String, "Optional"
set_variable :PUSHER_KEY, :String, "Optional"
set_variable :PUSHER_SECRET, :String, "Optional"
set_variable :PUSHER_BEAMS_ID, :String, "Optional"
set_variable :PUSHER_BEAMS_KEY, :String, "Optional"

# Google recaptcha
# (https://developers.google.com/recaptcha/intro)
set_variable :RECAPTCHA_SECRET, :String, "Optional"
set_variable :RECAPTCHA_SITE, :String, "Optional"

# Slack for customer alerts
# (https://api.slack.com/)
set_variable :SLACK_CHANNEL, :String, ""
set_variable :SLACK_WEBHOOK_URL, :String, ""

# Stripe for payment system
# (https://stripe.com/docs/api)
set_variable :STRIPE_PUBLISHABLE_KEY, :String, "Optional"
set_variable :STRIPE_SECRET_KEY, :String, "Optional"
set_variable :STRIPE_CANCELLATION_SECRET, :String, "Optional"

# For video calling in DEV Connect
# (https://www.twilio.com/docs/video)
set_variable :TWILIO_ACCOUNT_SID, :String, "Optional"
set_variable :TWILIO_VIDEO_API_KEY, :String, "Optional"
set_variable :TWILIO_VIDEO_API_SECRET, :String, "Optional"

# For Twitch live stream integration
# (https://dev.twitch.tv/docs)
set_variable :TWITCH_CLIENT_ID, :String, "Optional"
set_variable :TWITCH_CLIENT_SECRET, :String, "Optional"
set_variable :TWITCH_WEBHOOK_SECRET, :String, "Optional"

# Trending tags on home page
set_variable :TRENDING_TAGS, :String, "git,beginners"

# For calling the Stack Exchange API
# (https://api.stackexchange.com/docs)
set_variable :STACK_EXCHANGE_APP_KEY, :String, ""

##### Legacy test related env vars ######
set_variable :FACEBOOK_PIXEL_ID, :String, "Optional"
set_variable :SMARTY_STREETS_WEB_KEY, :String, "Optional"

group :production do
  set_variable :SECRET_KEY_BASE, :String

  # Timber
  # (https://docs.timber.io/)
  set_variable :SEND_LOGS_TO_TIMBER, :String  # Defaults to true in production, false in development
  set_variable :TIMBER, :String  # Only required if above is "true" or unset

  # Sendgrid
  # (https://sendgrid.com/docs/API_Reference/api_v3.html)
  set_variable :SENDGRID_USERNAME_ACCEL, :String
  set_variable :SENDGRID_PASSWORD_ACCEL, :String

  # Heroku
  set_variable :HEROKU_APP_URL, :String  # practicaldev.herokuapp.com
end
